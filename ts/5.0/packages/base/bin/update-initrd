#!/bin/bash

. $TS_GLOBAL

init()
{
LPATH=""
        until [ -z "$1" ] ; do
		case $1 in
			-p|--path)	LPATH="$2" ;;
			-l|--local)     LOCAL="1" ;;
			-h|--help)	HELP="1" ;;
			-w|--web)	WEB="1" ;;
			-s|--server)	SERVER="1" ;;
			*)		echo "Invalid Option: $1" ;;
                esac
		shift $#
	done
}
init $@

if [ "$LOCAL" == "1" ]; then
	cp /thinstation/ts/5.0/boot-images/initrd/initrd /boot/initrd
	cp /thinstation/ts/5.0/boot-images/initrd/vmlinuz /boot/vmlinuz
	if [ -e /thinstation/ts/5.0/boot-images/initrd/lib.squash ]; then
		cp /thinstation/ts/5.0/boot-images/initrd/lib.squash /boot/lib.update
	fi
elif [ "$SERVER" == "1" ]; then
	cd /boot
	if [ -e initrd ]; then
		rm initrd
		rm vmlinuz
	fi
	tftp -g -l initrd -r initrd -b $TFTP_BLOCKSIZE $SERVER_IP
	tftp -g -l vmlinuz -r vmlinuz -b $TFTP_BLOCKSIZE $SERVER_IP
	tftp -g -l lib.update -r lib.squash -b $TFTP_BLOCKSIZE $SERVER_IP
elif [ "$WEB" == "1" ]; then
	cd /tmp
        echo "Downloading a Default Image"
        wget http://www.doncuppjr.net/thindev-default.tar.xz
	cd /boot
        tar -xvf /tmp/thindev-default.tar.xz
        rm /tmp/thindev-default.tar.xz
elif [ "$LPATH" != "" ]; then
	if [ -e $LPATH/initrd ] && [ -e $LPATH/vmlinuz ]; then
	        cp $LPATH/initrd /boot/initrd
	        cp $LPATH/vmlinuz /boot/vmlinuz
	        if [ -e $LPATH/lib.squash ]; then
	                cp $LPATH/lib.squash /boot/lib.update
		fi
	else
		echo "Invalid Path or missing vmlinuz and initrd"
	fi
else
	echo "	Usage:	-l	Copy from the local build env"
	echo "		-s	Download from the dhcp assigned tftp server"
	echo "		-w	Download the default image from the web"
	echo "		-p	Copy from a user specified path"
	echo "							"
fi
