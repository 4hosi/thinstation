# Description: Mozilla Network Security Services (NSS) SysInit Module
# URL:         http://www.mozilla.org/projects/security/pki/nss/
# Maintainer:  Fredrk Rinnestam, fredrik at crux dot nu
# Depends on:  nspr sqlite3

name=nsssysinit
pname=nss
version=3.12.11
release=1
source=(ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_12_11_WITH_CKBI_1_87_RTM/src/$pname-$version.with.ckbi.1.87.tar.gz)

build() {
    cd $pname-$version/mozilla/security/nss/lib/sysinit

    CFLAGS="`pkg-config --cflags nss` $CFLAGS"
    CFLAGS="`pkg-config --cflags nspr` $CFLAGS"

    LDFLAGS="`pkg-config --libs nspr` $LDFLAGS"
    LDFLAGS="`pkg-config --libs nss` $LDFLAGS"

    gcc -fPIC -shared -Wl,-soname,lib$name.so $CFLAGS -I../softoken nsssysinit.c $LDFLAGS -o lib$name.so

    mkdir -p $PKG/usr/lib
    mv lib$name.so $PKG/usr/lib
}
